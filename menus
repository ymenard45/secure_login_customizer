<?php
/**
 * Plugin Name: Secure Login Customizer
 * Plugin URI: https://example.com/secure-login-customizer
 * Description: Un plugin pour customiser l'écran de connexion et ajouter des options de sécurité.
 * Version: 1.0
 * Author: Your Name
 * Author URI: https://example.com
 * Text Domain: secure-login-customizer
 * Domain Path: /languages
 * License: GPL v2 or later
 * License URI: https://www.gnu.org/licenses/gpl-2.0.html
 */

// Ligne 1
function slc_plugin_action_links($links) {
    $settings_link = '<a href="options-general.php?page=secure-login-customizer">' . __('Settings', 'secure-login-customizer') . '</a>';
    array_unshift($links, $settings_link);
    return $links;
}
// Ligne 5
add_filter('plugin_action_links_' . plugin_basename(__FILE__), 'slc_plugin_action_links');

// Charge le fichier de traduction du plugin.
function slc_load_plugin_textdomain() {
    load_plugin_textdomain('secure-login-customizer', false, basename(dirname(__FILE__)) . '/languages');
}
// Ligne 10
add_action('plugins_loaded', 'slc_load_plugin_textdomain');

// Ligne 1
function slc_add_plugin_menu() {
    add_options_page(
        __('Secure Login Customizer', 'secure-login-customizer'),
        __('Secure Login Customizer', 'secure-login-customizer'),
        'manage_options',
        'secure-login-customizer',
        'slc_render_plugin_settings_page'
    );
}
// Ligne 7
add_action('admin_menu', 'slc_add_plugin_menu');


function secure_login_customizer_tab_one() {
    if (!current_user_can('manage_options')) {
        wp_die(__('You do not have sufficient permissions to access this page.'));
    }
    
    if (isset($_POST['submit'])) {
        // Enregistrer les options dans la base de données
        update_option('secure_login_customizer_tab_one_2fa', isset($_POST['2fa']));
        update_option('secure_login_customizer_tab_one_backup_code', isset($_POST['backup_code']));
        update_option('secure_login_customizer_tab_one_2fa_disable', isset($_POST['2fa_disable']));
        update_option('secure_login_customizer_tab_one_2fa_security_groups', isset($_POST['2fa_security_groups']) ? $_POST['2fa_security_groups'] : []);
        
        // Afficher un message de confirmation
        echo '<div class="notice notice-success is-dismissible"><p>' . __('Options saved.', 'secure-login-customizer') . '</p></div>';
    }
    
    $tab_one_2fa = get_option('secure_login_customizer_tab_one_2fa');
    $tab_one_backup_code = get_option('secure_login_customizer_tab_one_backup_code');
    $tab_one_2fa_disable = get_option('secure_login_customizer_tab_one_2fa_disable');
    $tab_one_2fa_security_groups = get_option('secure_login_customizer_tab_one_2fa_security_groups');
    
    ?>
    <h2><?php _e('Tab 1', 'secure-login-customizer'); ?></h2>
    <form method="post">
        <table class="form-table">
            <tbody>
                <tr>
                    <th scope="row"><?php _e('Enable 2FA authentication', 'secure-login-customizer'); ?></th>
                    <td>
                        <input type="checkbox" name="2fa" value="1" <?php checked($tab_one_2fa, true); ?>>
                    </td>
                </tr>
                <tr>
                    <th scope="row"><?php _e('Enable backup code', 'secure-login-customizer'); ?></th>
                    <td>
                        <input type="checkbox" name="backup_code" value="1" <?php checked($tab_one_backup_code, true); ?>>
                    </td>
                </tr>
                <tr>
                    <th scope="row"><?php _e('Disallow 2FA authentication deactivation', 'secure-login-customizer'); ?></th>
                    <td>
                        <input type="checkbox" name="2fa_disable" value="1" <?php checked($tab_one_2fa_disable, true); ?>>
                    </td>
                </tr>
                <tr>
                    <th scope="row"><?php _e('Security groups for 2FA authentication', 'secure-login-customizer'); ?></th>
                    <td>
                        <select name="2fa_security_groups[]" multiple>
                            <?php
                                $groups = get_terms([
                                    'taxonomy' => 'security_groups',
                                    'hide_empty' => false,
                                ]);
                                foreach ($groups as $group) {
                                    $selected = in_array($group->term_id, $tab_one_2fa_security_groups) ? ' selected' : '';
                                    echo '<option value="' . esc_attr($group->term_id) . '"' . $selected . '>' . esc_html($group->name) . '</option>';
                                }
                            ?>
                        </select>
                    </td>
                </tr>
            </tbody>
        </table>
        <?php submit_button(__('Save changes', 'secure-login-customizer')); ?>
    </form>
    <?php
}


function secure_login_customizer_tab_two() {
    if (!current_user_can('manage_options')) {
        wp_die(__('You do not have sufficient permissions to access this page.'));
    }
    
    if (isset($_POST['submit'])) {
        // Enregistrer les options dans la base de données
        update_option('secure_login_customizer_tab_two_security_headers', isset($_POST['security_headers']));
        update_option('secure_login_customizer_tab_two_anonymize_messages', isset($_POST['anonymize_messages']));
        update_option('secure_login_customizer_tab_two_deny_proxy_connections', isset($_POST['deny_proxy_connections']));
        update_option('secure_login_customizer_tab_two_disallow_weak_passwords', isset($_POST['disallow_weak_passwords']));
        update_option('secure_login_customizer_tab_two_blacklist', isset($_POST['blacklist']) ? sanitize_text_field($_POST['blacklist']) : '');
        update_option('secure_login_customizer_tab_two_whitelist', isset($_POST['whitelist']) ? sanitize_text_field($_POST['whitelist']) : '');
        update_option('secure_login_customizer_tab_two_login_attempts', isset($_POST['login_attempts']) ? absint($_POST['login_attempts']) : 0);
        update_option('secure_login_customizer_tab_two_account_lockout', isset($_POST['account_lockout']) ? absint($_POST['account_lockout']) : 0);
        
        // Afficher un message de confirmation
        echo '<div class="notice notice-success is-dismissible"><p>' . __('Options saved.', 'secure-login-customizer') . '</p></div>';
    }
    
    $tab_two_security_headers = get_option('secure_login_customizer_tab_two_security_headers');
    $tab_two_anonymize_messages = get_option('secure_login_customizer_tab_two_anonymize_messages');
    $tab_two_deny_proxy_connections = get_option('secure_login_customizer_tab_two_deny_proxy_connections');
    $tab_two_disallow_weak_passwords = get_option('secure_login_customizer_tab_two_disallow_weak_passwords');
    $tab_two_blacklist = get_option('secure_login_customizer_tab_two_blacklist');
    $tab_two_whitelist = get_option('secure_login_customizer_tab_two_whitelist');
    $tab_two_login_attempts = get_option('secure_login_customizer_tab_two_login_attempts');
    $tab_two_account_lockout = get_option('secure_login_customizer_tab_two_account_lockout');
    
    ?>
        <h2><?php _e('Tab 2', 'secure-login-customizer'); ?></h2>
    <form method="post">
        <table class="form-table">
            <tbody>
                <tr>
                    <th scope="row"><?php _e('Enable security headers', 'secure-login-customizer'); ?></th>
                    <td>
                        <input type="checkbox" name="security_headers" value="1" <?php checked($tab_two_security_headers, true); ?>>
                    </td>
                </tr>
                <tr>
                    <th scope="row"><?php _e('Anonymize error messages', 'secure-login-customizer'); ?></th>
                    <td>
                        <input type="checkbox" name="anonymize_messages" value="1" <?php checked($tab_two_anonymize_messages, true); ?>>
                    </td>
                </tr>
                <tr>
                    <th scope="row"><?php _e('Deny proxy connections', 'secure-login-customizer'); ?></th>
                    <td>
                        <input type="checkbox" name="deny_proxy_connections" value="1" <?php checked($tab_two_deny_proxy_connections, true); ?>>
                    </td>
                </tr>
                <tr>
                    <th scope="row"><?php _e('Disallow weak passwords', 'secure-login-customizer'); ?></th>
                    <td>
                        <input type="checkbox" name="disallow_weak_passwords" value="1" <?php checked($tab_two_disallow_weak_passwords, true); ?>>
                    </td>
                </tr>
                <tr>
                    <th scope="row"><?php _e('Blacklist', 'secure-login-customizer'); ?></th>
                    <td>
                        <input type="text" name="blacklist" value="<?php echo esc_attr($tab_two_blacklist); ?>" class="regular-text">
                    </td>
                </tr>
                <tr>
                    <th scope="row"><?php _e('Whitelist', 'secure-login-customizer'); ?></th>
                    <td>
                        <input type="text" name="whitelist" value="<?php echo esc_attr($tab_two_whitelist); ?>" class="regular-text">
                    </td>
                </tr>
                <tr>
                    <th scope="row"><?php _e('Number of login attempts before lockout', 'secure-login-customizer'); ?></th>
                    <td>
                        <input type="number" name="login_attempts" value="<?php echo esc_attr($tab_two_login_attempts); ?>" class="regular-text" min="0" max="20">
                    </td>
                </tr>
                <tr>
                    <th scope="row"><?php _e('Account lockout time (in seconds)', 'secure-login-customizer'); ?></th>
                    <td>
                        <input type="number" name="account_lockout" value="<?php echo esc_attr($tab_two_account_lockout); ?>" class="regular-text" min="0" max="300">
                    </td>
                </tr>
            </tbody>
        </table>
        <?php submit_button(__('Save changes', 'secure-login-customizer')); ?>
    </form>
    <?php
}


function secure_login_customizer_tab_three() {
    if (!current_user_can('manage_options')) {
        wp_die(__('You do not have sufficient permissions to access this page.'));
    }
    
    if (isset($_POST['submit'])) {
        // Enregistrer les options dans la base de données
        update_option('secure_login_customizer_tab_three_logo_url', isset($_POST['logo_url']) ? esc_url($_POST['logo_url']) : '');
        update_option('secure_login_customizer_tab_three_desktop_url', isset($_POST['desktop_url']) ? esc_url($_POST['desktop_url']) : '');
        update_option('secure_login_customizer_tab_three_mobile_url', isset($_POST['mobile_url']) ? esc_url($_POST['mobile_url']) : '');
        update_option('secure_login_customizer_tab_three_button_color', isset($_POST['button_color']) ? sanitize_hex_color($_POST['button_color']) : '');
        update_option('secure_login_customizer_tab_three_background_color', isset($_POST['background_color']) ? sanitize_hex_color($_POST['background_color']) : '');
        update_option('secure_login_customizer_tab_three_text_color', isset($_POST['text_color']) ? sanitize_hex_color($_POST['text_color']) : '');
        update_option('secure_login_customizer_tab_three_border_color', isset($_POST['border_color']) ? sanitize_hex_color($_POST['border_color']) : '');
        update_option('secure_login_customizer_tab_three_opacity', isset($_POST['opacity']) ? absint($_POST['opacity']) : '');
        
        // Afficher un message de confirmation
        echo '<div class="notice notice-success is-dismissible"><p>' . __('Options saved.', 'secure-login-customizer') . '</p></div>';
    }
    
    $tab_three_logo_url = get_option('secure_login_customizer_tab_three_logo_url');
    $tab_three_desktop_url = get_option('secure_login_customizer_tab_three_desktop_url');
    $tab_three_mobile_url = get_option('secure_login_customizer_tab_three_mobile_url');
    $tab_three_button_color = get_option('secure_login_customizer_tab_three_button_color');
    $tab_three_background_color = get_option('secure_login_customizer_tab_three_background_color');
    $tab_three_text_color = get_option('secure_login_customizer_tab_three_text_color');
    $tab_three_border_color = get_option('secure_login_customizer_tab_three_border_color');
    $tab_three_opacity = get_option('secure_login_customizer_tab_three_opacity');
    
    ?>
      <h2><?php _e('Tab 3', 'secure-login-customizer'); ?></h2>
    <form method="post">
        <table class="form-table">
            <tbody>
                <tr>
                    <th scope="row"><?php _e('Logo URL', 'secure-login-customizer'); ?></th>
                    <td>
                        <input type="text" name="logo_url" value="<?php echo esc_url($tab_three_logo_url); ?>" class="regular-text">
                    </td>
                </tr>
                <tr>
                    <th scope="row"><?php _e('Desktop URL', 'secure-login-customizer'); ?></th>
                    <td>
                        <input type="text" name="desktop_url" value="<?php echo esc_url($tab_three_desktop_url); ?>" class="regular-text">
                    </td>
                </tr>
                <tr>
                    <th scope="row"><?php _e('Mobile URL', 'secure-login-customizer'); ?></th>
                    <td>
                        <input type="text" name="mobile_url" value="<?php echo esc_url($tab_three_mobile_url); ?>" class="regular-text">
                    </td>
                </tr>
                <tr>
                    <th scope="row"><?php _e('Button color', 'secure-login-customizer'); ?></th>
                    <td>
                        <input type="text" name="button_color" value="<?php echo esc_attr($tab_three_button_color); ?>" class="regular-text">
                    </td>
                </tr>
                <tr>
                    <th scope="row"><?php _e('Background color', 'secure-login-customizer'); ?></th>
                    <td>
                        <input type="text" name="background_color" value="<?php echo esc_attr($tab_three_background_color); ?>" class="regular-text">
                    </td>
                </tr>
                <tr>
                    <th scope="row"><?php _e('Text color', 'secure-login-customizer'); ?></th>
                    <td>
                        <input type="text" name="text_color" value="<?php echo esc_attr($tab_three_text_color); ?>" class="regular-text">
                    </td>
                </tr>
                <tr>
                    <th scope="row"><?php _e('Border color', 'secure-login-customizer'); ?></th>
                    <td>
                        <input type="text" name="border_color" value="<?php echo esc_attr($tab_three_border_color); ?>" class="regular-text">
                    </td>
                </tr>
                <tr>
                    <th scope="row"><?php _e('Opacity', 'secure-login-customizer'); ?></th>
                    <td>
                        <input type="number" name="opacity" value="<?php echo esc_attr($tab_three_opacity); ?>" class="regular-text" min="0" max="100">
                    </td>
                </tr>
            </tbody>
        </table>
        <?php submit_button(__('Save changes', 'secure-login-customizer'), 'primary', 'submit', true); ?>
    </form>
    <?php
}


function secure_login_customizer_tab_four() {
    if (!current_user_can('manage_options')) {
        wp_die(__('You do not have sufficient permissions to access this page.'));
    }
    
    if (isset($_POST['submit'])) {
        // Enregistrer les options dans la base de données
        update_option('secure_login_customizer_tab_four_qr_url', isset($_POST['qr_url']) ? esc_url($_POST['qr_url']) : '');
        update_option('secure_login_customizer_tab_four_code_url', isset($_POST['code_url']) ? esc_url($_POST['code_url']) : '');
        update_option('secure_login_customizer_tab_four_deactivation_url', isset($_POST['deactivation_url']) ? esc_url($_POST['deactivation_url']) : '');
        
        // Afficher un message de confirmation
        echo '<div class="notice notice-success is-dismissible"><p>' . __('Options saved.', 'secure-login-customizer') . '</p></div>';
    }
    
    $tab_four_qr_url = get_option('secure_login_customizer_tab_four_qr_url');
    $tab_four_code_url = get_option('secure_login_customizer_tab_four_code_url');
    $tab_four_deactivation_url = get_option('secure_login_customizer_tab_four_deactivation_url');
    
    ?>
    <h2><?php _e('Tab 4', 'secure-login-customizer'); ?></h2>
    <form method="post">
        <table class="form-table">
            <tbody>
                <tr>
                    <th scope="row"><?php _e('QR code URL', 'secure-login-customizer'); ?></th>
                    <td>
                        <input type="text" name="qr_url" value="<?php echo esc_url($tab_four_qr_url); ?>" class="regular-text">
                    </td>
                </tr>
                <tr>
                    <th scope="row"><?php _e('Code URL', 'secure-login-customizer'); ?></th>
                    <td>
                        <input type="text" name="code_url" value="<?php echo esc_url($tab_four_code_url); ?>" class="regular-text">
                    </td>
                </tr>
                <tr>
                    <th scope="row"><?php _e('Deactivation URL', 'secure-login-customizer'); ?></th>
                    <td>
                        <input type="text" name="deactivation_url" value="<?php echo esc_url($tab_four_deactivation_url); ?>" class="regular-text">
                    </td>
                </tr>
            </tbody>
        </table>
        <?php submit_button(__('Save changes', 'secure-login-customizer'), 'primary', 'submit', true); ?>
    </form>
    <?php
}

function secure_login_customizer_tab_five() {
    if (!current_user_can('manage_options')) {
        wp_die(__('You do not have sufficient permissions to access this page.'));
    }
    
    ?>
    <h2><?php _e('Tab 5', 'secure-login-customizer'); ?></h2>
    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam quis elit euismod, iaculis dolor vel, sagittis massa. Nulla facilisi. Aliquam id tellus auctor, faucibus eros vel, ultrices enim. Donec malesuada aliquam diam ac scelerisque. Donec at varius lorem. Morbi sit amet quam vel urna faucibus mollis. In fringilla massa ac lorem pharetra, quis lacinia justo viverra. Sed quis erat nibh. Vestibulum quis lorem velit.</p>
    <p>Donec a metus sit amet eros tempor vestibulum. Nunc a lectus vel dolor ullamcorper sagittis eu id mauris. Nunc imperdiet est quis ipsum facilisis scelerisque. Nulla facilisi. Sed eleifend ipsum sit amet massa laoreet, sit amet facilisis eros efficitur. Donec aliquet sem at ante vestibulum interdum. Suspendisse luctus orci id nunc rutrum, sed laoreet augue venenatis. Vivamus blandit, sapien eget iaculis placerat, lacus dui fermentum orci, eu suscipit sapien quam nec neque. Fusce eget turpis vel augue lacinia laoreet eu vel enim. Donec quis feugiat quam. Donec bibendum euismod urna, ac pellentesque urna pellentesque et.</p>
    <p>Sed vel ipsum sed enim euismod dictum vel ut velit. Sed ut ligula a quam suscipit dictum. Curabitur non nibh condimentum, finibus est quis, varius lectus. Nunc euismod volutpat ante, sed fringilla urna commodo ut. Vivamus at ligula sed odio suscipit lacinia vel ac quam. Donec viverra gravida sapien, in ullamcorper nibh eleifend quis. Sed pharetra elit velit, sed faucibus odio euismod vel. Duis efficitur neque in massa aliquam, vel bibendum nisl vestibulum. Praesent eu tellus eu eros blandit suscipit non non nibh. Pellentesque eu velit id nulla congue faucibus. Sed tincidunt libero ut felis venenatis, id vehicula neque bibendum. Integer dignissim tristique orci, sit amet suscipit nisl ultricies vel. Donec facilisis turpis vel laoreet fermentum. Donec at interdum ipsum, a porttitor velit.</p>
    <?php
}

// strcuture html pour les onglets

function slc_render_plugin_settings_page() {
    ?>
    <div class="wrap">
        <h1><?php _e('Secure Login Customizer', 'secure-login-customizer'); ?></h1>
        <h2 class="nav-tab-wrapper">
            <a href="#tab1" class="nav-tab"><?php _e('Tab 1', 'secure-login-customizer'); ?></a>
            <a href="#tab2" class="nav-tab"><?php _e('Tab 2', 'secure-login-customizer'); ?></a>
            <a href="#tab3" class="nav-tab"><?php _e('Tab 3', 'secure-login-customizer'); ?></a>
            <a href="#tab4" class="nav-tab"><?php _e('Tab 4', 'secure-login-customizer'); ?></a>
            <a href="#tab5" class="nav-tab"><?php _e('Tab 5', 'secure-login-customizer'); ?></a>
        </h2>
        <form action="options.php" method="post">
            <?php settings_fields('secure_login_customizer_options'); ?>
            <?php do_settings_sections('secure-login-customizer'); ?>
            <div id="tab1" class="tab-content">
                <?php secure_login_customizer_tab_one(); ?>
            </div>
            <div id="tab2" class="tab-content">
                <?php secure_login_customizer_tab_two(); ?>
            </div>
            <div id="tab3" class="tab-content">
                <?php secure_login_customizer_tab_three(); ?>
            </div>
            <div id="tab4" class="tab-content">
                <?php secure_login_customizer_tab_four(); ?>
            </div>
            <div id="tab5" class="tab-content">
                <?php secure_login_customizer_tab_five(); ?>
            </div>
            <?php submit_button(); ?>
        </form>
    </div>
    <?php
}


// fin function slc_render_plugin_settings_page

function slc_save_tab_one_settings() {
    // Vérifier que l'utilisateur a la permission de modifier les paramètres
    if ( ! current_user_can( 'manage_options' ) ) {
        return;
    }

    // Vérifier que le nonce est valide
    if ( ! isset( $_POST['slc_settings_nonce'] ) || ! wp_verify_nonce( $_POST['slc_settings_nonce'], 'slc_save_settings' ) ) {
        return;
    }

    // Enregistrer les paramètres soumis
    update_option( 'slc_tab_one_setting_one', isset( $_POST['slc_tab_one_setting_one'] ) ? sanitize_text_field( $_POST['slc_tab_one_setting_one'] ) : '' );
    update_option( 'slc_tab_one_setting_two', isset( $_POST['slc_tab_one_setting_two'] ) ? sanitize_text_field( $_POST['slc_tab_one_setting_two'] ) : '' );
    update_option( 'slc_tab_one_setting_three', isset( $_POST['slc_tab_one_setting_three'] ) ? sanitize_text_field( $_POST['slc_tab_one_setting_three'] ) : '' );
    update_option( 'slc_tab_one_setting_four', isset( $_POST['slc_tab_one_setting_four'] ) ? sanitize_text_field( $_POST['slc_tab_one_setting_four'] ) : '' );
}
add_action( 'admin_post_slc_save_tab_one_settings', 'slc_save_tab_one_settings' );

// Fonction pour enregistrer les paramètres de l'onglet 2
function slc_save_tab_two_settings() {
    // Vérifier que l'utilisateur a la permission de modifier les paramètres
    if ( ! current_user_can( 'manage_options' ) ) {
        return;
    }

    // Vérifier que le nonce est valide
    if ( ! isset( $_POST['slc_settings_nonce'] ) || ! wp_verify_nonce( $_POST['slc_settings_nonce'], 'slc_save_settings' ) ) {
        return;
    }

    // Enregistrer les paramètres soumis
    update_option( 'slc_tab_two_setting_one', isset( $_POST['slc_tab_two_setting_one'] ) ? sanitize_text_field( $_POST['slc_tab_two_setting_one'] ) : '' );
    update_option( 'slc_tab_two_setting_two', isset( $_POST['slc_tab_two_setting_two'] ) ? sanitize_text_field( $_POST['slc_tab_two_setting_two'] ) : '' );
    update_option( 'slc_tab_two_setting_three', isset( $_POST['slc_tab_two_setting_three'] ) ? sanitize_text_field( $_POST['slc_tab_two_setting_three'] ) : '' );
    update_option( 'slc_tab_two_setting_four', isset( $_POST['slc_tab_two_setting_four'] ) ? sanitize_text_field( $_POST['slc_tab_two_setting_four'] ) : '' );
    update_option( 'slc_tab_two_setting_five', isset( $_POST['slc_tab_two_setting_five'] ) ? sanitize_text_field( $_POST['slc_tab_two_setting_five'] ) : '' );
    update_option( 'slc_tab_two_setting_six', isset( $_POST['slc_tab_two_setting_six'] ) ? sanitize_text_field( $_POST['slc_tab_two_setting_six'] ) : '' );
    update_option( 'slc_tab_two_setting_seven', isset( $_POST['slc_tab_two_setting_seven'] ) ? sanitize_text_field( $_POST['slc_tab_two_setting_seven'] ) : '' );
    update_option( 'slc_tab_two_setting_eight', isset( $_POST['slc_tab_two_setting_eight'] ) ? sanitize_text_field( $_POST['slc_tab_two_setting_eight'] ) : '' );
}

// Enregistrer les paramètres de l'onglet 2
add_action( 'admin_post_slc_save_tab_two_settings', 'slc_save_tab_two_settings' );

// Fonction pour enregistrer les paramètres de l'onglet 3
function slc_save_tab_three_settings() {
    // Vérifier que l'utilisateur a la permission de modifier les paramètres
    if ( ! current_user_can( 'manage_options' ) ) {
        return;
    }

    // Vérifier que le nonce est valide
    if ( ! isset( $_POST['slc_settings_nonce'] ) || ! wp_verify_nonce( $_POST['slc_settings_nonce'], 'slc_save_settings' ) ) {
        return;
    }
}
	// Enregistrer les paramètres soumis de l'onglet 2
	update_option( 'slc_tab_two_setting_one', isset( $_POST['slc_tab_two_setting_one'] ) ? sanitize_text_field( $_POST['slc_tab_two_setting_one'] ) : '' );
	update_option( 'slc_tab_two_setting_two', isset( $_POST['slc_tab_two_setting_two'] ) ? sanitize_text_field( $_POST['slc_tab_two_setting_two'] ) : '' );

	// Enregistrer les paramètres de l'onglet 3
	add_action( 'admin_post_slc_save_tab_three_settings', 'slc_save_tab_three_settings' );

// Fonction pour enregistrer les paramètres de l'onglet 4
function slc_save_tab_four_settings() {
    // Vérifier que l'utilisateur a la permission de modifier les paramètres
    if ( ! current_user_can( 'manage_options' ) ) {
        return;
    }

    // Vérifier que le nonce est valide
    if ( ! isset( $_POST['slc_settings_nonce'] ) || ! wp_verify_nonce( $_POST['slc_settings_nonce'], 'slc_save_settings' ) ) {
        return;
    }

    // Enregistrer les paramètres soumis
    update_option( 'slc_tab_four_setting_one', isset( $_POST['slc_tab_four_setting_one'] ) ? sanitize_text_field( $_POST['slc_tab_four_setting_one'] ) : '' );
    update_option( 'slc_tab_four_setting_two', isset( $_POST['slc_tab_four_setting_two'] ) ? sanitize_text_field( $_POST['slc_tab_four_setting_two'] ) : '' );
    update_option( 'slc_tab_four_setting_three', isset( $_POST['slc_tab_four_setting_three'] ) ? sanitize_text_field( $_POST['slc_tab_four_setting_three'] ) : '' );
}

// Enregistrer les paramètres de l'onglet 4
add_action( 'admin_post_slc_save_tab_four_settings', 'slc_save_tab_four_settings' );

// Fonction pour enregistrer les paramètres de l'onglet 5
function slc_save_tab_five_settings() {
    // Vérifier que l'utilisateur a la permission de modifier les paramètres
    if ( ! current_user_can( 'manage_options' ) ) {
        return;
    }

    // Vérifier que le nonce est valide
    if ( ! isset( $_POST['slc_settings_nonce'] ) || ! wp_verify_nonce( $_POST['slc_settings_nonce'], 'slc_save_settings' ) ) {
        return;
    }

    // Enregistrer les paramètres soumis
    update_option( 'slc_tab_five_setting_one', isset( $_POST['slc_tab_five_setting_one'] ) ? sanitize_text_field( $_POST['slc_tab_five_setting_one'] ) : '' );
    update_option( 'slc_tab_five_setting_two', isset( $_POST['slc_tab_five_setting_two'] ) ? sanitize_text_field( $_POST['slc_tab_five_setting_two'] ) : '' );
    update_option( 'slc_tab_five_setting_three', isset( $_POST['slc_tab_five_setting_three'] ) ? sanitize_text_field( $_POST['slc_tab_five_setting_three'] ) : '' );
}

// Enregistrer les paramètres de l'onglet 5
add_action( 'admin_post_slc_save_tab_five_settings', 'slc_save_tab_five_settings' );



// Styles personnalisés
function slc_custom_styles() {
    ?>
    <style>
        .tab-content p:first-child {
            margin-top: 15px;
        }
        .dashicons-shield {
            font-size: 36px;
            margin-right: 10px;
            vertical-align: middle;
        }
        .form {
            margin-top: 15px;
        }
        .wrap > h1 {
            color: blue;
            margin-bottom: 30px;
        }
        .tab-content {
            margin-left: 25px;
        }
        h1.slc-plugin-title,
        .tab-content h2 {
            display: none;
        }
        .slc-title-container {
            text-align: center;
        }
        .slc-title-container h1 {
            display: inline-block;
            vertical-align: middle;
            margin-left: 15px;
            margin-right: 10px;
            font-size: 36px;
            color: blue;
        }
        .nav-tab {
            padding-top: 10px;
            padding-bottom: 10px;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        .dashicons-shield {
            font-size: 36px;
            margin-right: 5px;
            vertical-align: middle;
        }
    </style>
    <?php
}
add_action('admin_head', 'slc_custom_styles');



// gestion des onglets avec javascript
function slc_admin_scripts() {
    ?>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function(event) {
                    event.preventDefault();
                    const target = event.target.getAttribute('href');
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('nav-tab-active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
                    event.target.classList.add('nav-tab-active');
                    document.querySelector(target).style.display = 'block';
                });
            });
            tabs[0].click();
        });
    </script>
    <?php
}
// activation onglets
add_action('admin_footer', 'slc_admin_scripts');

//  fonction pour enregistrer les paramètres de l'onglet 1
function slc_register_2fa_settings() {
    register_setting('slc_2fa_settings', 'slc_2fa_settings', 'slc_sanitize_2fa_settings');

    add_settings_section('slc_2fa_section', __('Paramètres 2FA', 'secure-login-customizer'), 'slc_2fa_section_callback', 'slc_2fa_settings');

    // Ajoutez les champs de l'onglet 1 ici (nous le ferons dans les prochaines étapes).
}
add_action('admin_init', 'slc_register_2fa_settings');

// focntion pour les champs de l'onglet 1
function slc_2fa_section_callback() {
    _e('Paramètres de l\'authentification à deux facteurs (2FA).', 'secure-login-customizer');
}

// Ligne 1
function slc_add_2fa_fields() {
    add_settings_field('enable_2fa', __('Activer 2FA authentification', 'secure-login-customizer'), 'slc_enable_2fa_callback', 'slc_2fa_settings', 'slc_2fa_section');
    add_settings_field('enable_backup_codes', __('Activer code de secours', 'secure-login-customizer'), 'slc_enable_backup_codes_callback', 'slc_2fa_settings', 'slc_2fa_section');
    add_settings_field('disable_2fa_disabling', __('Interdire la désactivation de 2FA authentification', 'secure-login-customizer'), 'slc_disable_2fa_disabling_callback', 'slc_2fa_settings', 'slc_2fa_section');
    add_settings_field('security_group', __('Sélection des groupes de sécurité', 'secure-login-customizer'), 'slc_security_group_callback', 'slc_2fa_settings', 'slc_2fa_section');
}
// Ligne 5
add_action('admin_init', 'slc_add_2fa_fields');

// focntion pour gerer activer option activer 2FA de l'onglet 1
function slc_enable_2fa_callback() {
    $options = get_option('slc_2fa_settings');
    ?>
    <input type="checkbox" name="slc_2fa_settings[enable_2fa]" value="1" <?php checked(1, $options['enable_2fa'], true); ?>>
    <?php
}
// focntion pour gerer l'option 'code de securité'
function slc_enable_backup_codes_callback() {
    $options = get_option('slc_2fa_settings');
    ?>
    <input type="checkbox" name="slc_2fa_settings[enable_backup_codes]" value="1" <?php checked(1, $options['enable_backup_codes'], true); ?>>
    <?php
}
// focntion pour gerer desactiver option activer 2FA de l'onglet 1
function slc_disable_2fa_disabling_callback() {
    $options = get_option('slc_2fa_settings');
    ?>
    <input type="checkbox" name="slc_2fa_settings[disable_2fa_disabling]" value="1" <?php checked(1, $options['disable_2fa_disabling'], true); ?>>
    <?php
}

// fonction 
function slc_security_group_callback() {
    $options = get_option('slc_2fa_settings');
    ?>
    <select name="slc_2fa_settings[security_group]">
        <option value="1" <?php selected($options['security_group'], '1'); ?>><?php _e('Groupe 1', 'secure-login-customizer'); ?></option>
        <option value="2" <?php selected($options['security_group'], '2'); ?>><?php _e('Groupe 2', 'secure-login-customizer'); ?></option>
        <!-- Ajoutez d'autres groupes de sécurité ici si nécessaire -->
    </select>
    <?php
}

/* Fonctions pour gérer l'onglet 2 */

// fonction pour enregistrer les paramètres de onglet 2
 
	function slc_register_security_settings() {
		register_setting('slc_security_settings', 'slc_security_settings', 'slc_sanitize_security_settings');

		add_settings_section('slc_security_section', __('Paramètres de sécurité', 'secure-login-customizer'), 'slc_security_section_callback', 'slc_security_settings');

		// Ajoutez les champs de l'onglet 2 ici (nous le ferons dans les prochaines étapes).
	}
 
	add_action('admin_init', 'slc_register_security_settings');

	function slc_security_section_callback() {
		_e('Paramètres de sécurité pour le site.', 'secure-login-customizer');
	}

	// Ligne 1
	function slc_add_security_fields() {
		add_settings_field('enable_security_headers', __('Activer Security headers', 'secure-login-customizer'), 'slc_enable_security_headers_callback', 'slc_security_settings', 'slc_security_section');
		// Ajoutez les autres champs de l'onglet 2 ici (nous le ferons dans les prochaines étapes).
	}
	 
	add_action('admin_init', 'slc_add_security_fields');

	// champ security headers
	function slc_enable_security_headers_callback() {
		$options = get_option('slc_security_settings');
		?>
		<input type="checkbox" name="slc_security_settings[enable_security_headers]" value="1" <?php checked(1, $options['enable_security_headers'], true); ?>>
		<?php
	}
/* Fonctions pour gérer l'onglet 3 */
 
 // Ligne 1
 
	function slc_register_custom_login_screen_settings() {
		register_setting('slc_custom_login_screen_settings', 'slc_custom_login_screen_settings', 'slc_sanitize_custom_login_screen_settings');

		add_settings_section('slc_custom_login_screen_section', __('Paramètres de customisation de l’écran de connexion', 'secure-login-customizer'), 'slc_custom_login_screen_section_callback', 'slc_custom_login_screen_settings');

		// Ajoutez les champs de l'onglet 3 ici (nous le ferons dans les prochaines étapes).
	}    // fin slc_register_custom_login_screen_settings
		add_action('admin_init', 'slc_register_custom_login_screen_settings');

	function slc_custom_login_screen_section_callback() {
		_e('Paramètres de customisation de l’écran de connexion.', 'secure-login-customizer');
	}
 
	function slc_add_custom_login_screen_fields() {
		add_settings_field('logo_url', __('URL du logo', 'secure-login-customizer'), 'slc_logo_url_callback', 'slc_custom_login_screen_settings', 'slc_custom_login_screen_section');
		// Ajoutez les autres champs de l'onglet 3 ici (nous le ferons dans les prochaines étapes).
	}
	// Ligne 4
	add_action('admin_init', 'slc_add_custom_login_screen_fields');

// Ligne 1
	function slc_logo_url_callback() {
    $options = get_option('slc_custom_login_screen_settings');
    ?>
    <input type="text" name="slc_custom_login_screen_settings[logo_url]" value="<?php echo esc_attr($options['logo_url']); ?>" size="75">
    <?php
}

/* Fonctions pour gérer l'onglet 4 */

	function slc_register_custom_message_settings() {
    register_setting('slc_custom_message_settings', 'slc_custom_message_settings', 'slc_sanitize_custom_message_settings');

    add_settings_section('slc_custom_message_section', __('Paramètres de customisation des messages', 'secure-login-customizer'), 'slc_custom_message_section_callback', 'slc_custom_message_settings');

    // Ajoutez les champs de l'onglet 4 ici (nous le ferons dans les prochaines étapes).
	}
	add_action('admin_init', 'slc_register_custom_message_settings');

	function slc_custom_message_section_callback() {
    _e('Paramètres de customisation des messages.', 'secure-login-customizer');
	}

	function slc_add_custom_message_fields() {
    add_settings_field('qr_code_info_url', __('URL de la page pour information QR-CODE', 'secure-login-customizer'), 'slc_qr_code_info_url_callback', 'slc_custom_message_settings', 'slc_custom_message_section');
    // Ajoutez les autres champs de l'onglet 4 ici (nous le ferons dans les prochaines étapes).
	}
	add_action('admin_init', 'slc_add_custom_message_fields');

function slc_qr_code_info_url_callback() {
    $options = get_option('slc_custom_message_settings');
    ?>
    <input type="text" name="slc_custom_message_settings[qr_code_info_url]" value="<?php echo esc_attr($options['qr_code_info_url']); ?>" size="75">
    <?php
}

/* Fonctions pour gérer l'onglet 5 non necessaires */

/* Fonctions pour créer le menu */

// Créer le menu de l'extension
function slc_add_plugin_page() {
    add_menu_page(
        'Secure Login Customizer',
        'Secure Login Customizer',
        'manage_options',
        'secure-login-customizer',
        'slc_render_plugin_settings_page',
        'dashicons-lock',
        100
    );
}
add_action('admin_menu', 'slc_add_plugin_page');
