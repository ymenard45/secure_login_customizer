<?php
/*
Plugin Name: SecureLoginCustomizer
Description: Plugin de personnalisation du processus de connexion et d'amélioration de la sécurité
Version: 1.0
Author: Your Name
Author URI: https://example.com
*/

// Ajout d'un menu pour le plugin
add_action('admin_menu', 'slc_plugin_setup_menu');

function slc_plugin_setup_menu() {
  add_menu_page('SecureLoginCustomizer', 'SecureLoginCustomizer', 'manage_options', 'secure_login_customizer', 'slc_plugin_homepage', '', 90);
}

// Page d'accueil du plugin
function slc_plugin_homepage() {
  ?>
  <div class="wrap">
    <h1>SecureLoginCustomizer</h1>
    <p>Bienvenue sur la page d'accueil du plugin SecureLoginCustomizer.</p>
    <p>Ce plugin permet de personnaliser le processus de connexion et d'améliorer la sécurité.</p>
  </div>
  <?php
}

// Ajout des onglets
add_action('admin_init', 'slc_initialize_plugin_options');

function slc_initialize_plugin_options() {
  // Onglet 1 - Sécurité 2FA
  add_settings_section('slc_2fa_section', '2FA Authentification', 'slc_2fa_section_callback', 'slc_2fa_settings_page');
  add_settings_field('enable_2fa', 'Activer 2FA Authentification', 'slc_enable_2fa_callback', 'slc_2fa_settings_page', 'slc_2fa_section');
  add_settings_field('enable_backup_codes', 'Activer Code de Secours', 'slc_enable_backup_codes_callback', 'slc_2fa_settings_page', 'slc_2fa_section');
  add_settings_field('disable_2fa_disabling', 'Interdire la Désactivation de 2FA Authentification', 'slc_disable_2fa_disabling_callback', 'slc_2fa_settings_page', 'slc_2fa_section');
  add_settings_field('security_groups', 'Groupes de Sécurité où 2FA sera Activé', 'slc_security_groups_callback', 'slc_2fa_settings_page', 'slc_2fa_section');
  register_setting('slc_2fa_settings', 'slc_2fa_settings');

// Onglet 2 - Sécurité
add_settings_section('slc_security_section', 'Sécurité', 'slc_security_section_callback', 'slc_security_settings_page');

add_settings_field('x-xss-protection', 'X-XSS-Protection', 'slc_security_headers_callback', 'slc_security_settings_page', 'slc_security_section', array('x-xss-protection', 'slc_security_settings', true));
add_settings_field('x-frame-options', 'X-Frame-Options', 'slc_security_headers_callback', 'slc_security_settings_page', 'slc_security_section', array('x-frame-options', 'slc_security_settings', true));
add_settings_field('x-content-type-options', 'X-Content-Type-Options', 'slc_security_headers_callback', 'slc_security_settings_page', 'slc_security_section', array('x-content-type-options', 'slc_security_settings', true));
add_settings_field('content-security-policy', 'Content-Security-Policy', 'slc_security_headers_callback', 'slc_security_settings_page', 'slc_security_section', array('content-security-policy', 'slc_security_settings', false));
add_settings_field('strict-transport-security', 'Strict-Transport-Security', 'slc_security_headers_callback', 'slc_security_settings_page', 'slc_security_section', array('strict-transport-security', 'slc_security_settings', true));

add_settings_field('anonymize-messages', 'Anonymiser les messages', 'slc_anonymize_messages_callback', 'slc_security_settings_page', 'slc_security_section', array('anonymize-messages', 'slc_security_settings', false));
add_settings_field('proxy-block', 'Refuser les connexions depuis un proxy', 'slc_proxy_block_callback', 'slc_security_settings_page', 'slc_security_section', array('proxy-block', 'slc_security_settings', false));
add_settings_field('weak-passwords', 'Interdire les mots de passe à faible sécurité', 'slc_weak_passwords_callback', 'slc_security_settings_page', 'slc_security_section', array('weak-passwords', 'slc_security_settings', false));

add_settings_field('blacklist', 'Liste noire des IP', 'slc_blacklist_callback', 'slc_security_settings_page', 'slc_security_section', array('blacklist', 'slc_security_settings', ''));
add_settings_field('whitelist', 'Liste blanche des IP', 'slc_whitelist_callback', 'slc_security_settings_page', 'slc_security_section', array('whitelist', 'slc_security_settings', ''));

add_settings_field('login-attempts', 'Nombre de tentatives de connexion avant désactivation', 'slc_login_attempts_callback', 'slc_security_settings_page', 'slc_security_section', array('login-attempts', 'slc_security_settings', 0));
add_settings_field('account-lock-time', 'Temps de blocage du compte', 'slc_account_lock_time_callback', 'slc_security_settings_page', 'slc_security_section', array('account-lock-time', 'slc_security_settings', 0));

// Onglet 3 - Customisation de l'écran de connexion
add_settings_section('slc_customization_section', 'Customisation de l\'écran de connexion', 'slc_customization_section_callback', 'slc_security_settings_page');

// Champ 1 - URL du logo
add_settings_field('slc_login_logo', 'URL du logo', 'slc_login_logo_callback', 'slc_security_settings_page', 'slc_customization_section');
register_setting('slc_security_settings', 'slc_login_logo');

// Champ 2 - URL pour desktop
add_settings_field('slc_desktop_image', 'URL pour desktop', 'slc_desktop_image_callback', 'slc_security_settings_page', 'slc_customization_section');
register_setting('slc_security_settings', 'slc_desktop_image');

// Champ 3 - URL pour mobile
add_settings_field('slc_mobile_image', 'URL pour mobile', 'slc_mobile_image_callback', 'slc_security_settings_page', 'slc_customization_section');
register_setting('slc_security_settings', 'slc_mobile_image');

// Champ 4 - Couleur du bouton
add_settings_field('slc_button_color', 'Couleur du bouton', 'slc_button_color_callback', 'slc_security_settings_page', 'slc_customization_section');
register_setting('slc_security_settings', 'slc_button_color');

// Champ 5 - Couleur de fond
add_settings_field('slc_background_color', 'Couleur de fond', 'slc_background_color_callback', 'slc_security_settings_page', 'slc_customization_section');
register_setting('slc_security_settings', 'slc_background_color');

// Champ 6 - Couleur du texte
add_settings_field('slc_text_color', 'Couleur du texte', 'slc_text_color_callback', 'slc_security_settings_page', 'slc_customization_section');
register_setting('slc_security_settings', 'slc_text_color');

// Champ 7 - Couleur des bordures
add_settings_field('slc_border_color', 'Couleur des bordures', 'slc_border_color_callback', 'slc_security_settings_page', 'slc_customization_section');
register_setting('slc_security_settings', 'slc_border_color');

// Champ 8 - Niveau de transparence
add_settings_field('slc_transparency_level', 'Niveau de transparence (0-100)', 'slc_transparency_level_callback', 'slc_security_settings_page', 'slc_customization_section');
register_setting('slc_security_settings', 'slc_transparency_level');

// Onglet 4 - Customisation des messages
add_settings_section('slc_messages_section', 'Customisation des messages', 'slc_messages_section_callback', 'slc_security_settings_page');

// Champ URL QR Code Info
add_settings_field('slc_qrcode_url_field', 'URL de la page d\'information QR Code', 'slc_qrcode_url_callback', 'slc_security_settings_page', 'slc_messages_section');

// Champ URL Désactivation Compte Info
add_settings_field('slc_disable_account_url_field', 'URL de la page d\'information Désactivation Compte', 'slc_disable_account_url_callback', 'slc_security_settings_page', 'slc_messages_section');

// Enregistrement des options
register_setting('slc_security_settings', 'slc_security_settings');
}

// Fonction de callback pour l'affichage de la section Customisation des messages
function slc_messages_section_callback() {
    echo 'Personnalisez les messages affichés dans votre zone d\'administration.';
}

// Fonction de callback pour l'affichage du champ URL QR Code Info
function slc_qrcode_url_callback() {
$options = get_option('slc_security_settings');
?>
<input type="url" name="slc_security_settings[qrcode_url]" value="<?php echo $options['qrcode_url']; ?>" size="75">
<?php
}

// Fonction de callback pour l'affichage du champ URL Secret Code Info
function slc_secret_code_url_callback() {
$options = get_option('slc_security_settings');
?>
<input type="url" name="slc_security_settings[secret_code_url]" value="<?php echo $options['secret_code_url']; ?>" size="75">
<?php
}

// Fonction de callback pour l'affichage du champ URL Désactivation Compte Info
function slc_disable_account_url_callback() {
$options = get_option('slc_security_settings');
?>
<input type="url" name="slc_security_settings[disable_account_url]" value="<?php echo $options['disable_account_url']; ?>" size="75">

<?php
}

// Fonction de callback pour l'affichage de la section Customisation de l'écran de connexion
function slc_customization_section_callback() {
echo 'Personnalisez l\'écran de connexion de votre site web.';
}

// Fonction de callback pour l'affichage du champ URL du logo
function slc_login_logo_callback() {
$options = get_option('slc_security_settings');
?>
<input type="url" name="slc_security_settings[login_logo]" value="<?php echo $options['login_logo']; ?>" size="75">
<?php
}
// Fonction de callback pour l'affichage du champ URL pour desktop
function slc_desktop_image_callback() {
$options = get_option('slc_security_settings');
?>
<input type="url" name="slc_security_settings[desktop_image]" value="<?php echo $options['desktop_image']; ?>" size="75">

<?php
}

// Fonction de callback pour l'affichage du champ URL pour mobile
function slc_mobile_image_callback() {
$options = get_option('slc_security_settings');
?>
<input type="url" name="slc_security_settings[mobile_image]" value="<?php echo $options['mobile_image']; ?>" size="75">
<?php
}
// Fonction de callback pour l'affichage du champ Couleur du bouton
function slc_button_color_callback() {
$options = get_option('slc_security_settings');
?>
<input type="color" name="slc_security_settings[button_color]" value="<?php echo $options['button_color']; ?>">

<?php
}

// Fonction de callback pour l'affichage du champ Couleur de fond
function slc_background_color_callback() {
$options = get_option('slc_security_settings');
?>
<input type="color" name="slc_security_settings[background_color]" value="<?php echo $options['background_color']; ?>">
<?php
}

// Fonction de callback pour l'affichage du champ Couleur du texte
function slc_text_color_callback() {
    $options = get_option('slc_security_settings');
    ?>
    <input type="color" name="slc_security_settings[text_color]" value="<?php echo $options['text_color']; ?>"></input>
    <?php
}

// Fonction de callback pour l'affichage du champ Couleur des bordures
function slc_border_color_callback() {
    $options = get_option('slc_security_settings');
    ?>
    <input type="color" name="slc_security_settings[border_color]" value="<?php echo $options['border_color']; ?>">
    <?php
}


// Fonction de callback pour l'affichage du champ Niveau de transparence
function slc_transparency_level_callback() {
$options = get_option('slc_security_settings');
?>
<input type="range" name="slc_security_settings[transparency_level]" min="0" max="100" value="<?php echo $options['transparency_level']; ?>">

<?php
}

// Fonction de callback pour l'affichage de la section Sécurité
function slc_security_section_callback() {
echo 'Personnalisez les options de sécurité pour votre site web.';
}

// Fonction de callback pour l'affichage du champ X-XSS-Protection, X-Frame-Options et Strict-Transport-Security
function slc_security_headers_callback($args) {
$header = $args[0];
$options_name = $args[1];
$default_enabled = $args[2];
$options = get_option($options_name);
?>
<input type="checkbox" name="<?php echo $options_name.'['.$header.'_enabled]'; ?>" value="1" <?php checked($options[$header.'_enabled'], 1, true); ?>>
<label for="<?php echo $options_name.'['.$header.'_enabled]'; ?>"><?php echo $header; ?></label>

  <?php if ($default_enabled) { ?>
  <br>
  <input type="text" name="<?php echo $options_name.'['.$header.']'; ?>" value="<?php echo $options[$header]; ?>" size="75">
  <?php } ?>
  <?php
}
// Fonction de callback pour l'affichage du champ Anonymize Messages
function slc_anonymize_messages_callback($args) {
$option_name = $args[0];
$options = get_option($option_name);
?>
<input type="checkbox" name="<?php echo $option_name.'[anonymize-messages]'; ?>" value="1" <?php checked($options['anonymize-messages'], 1, true); ?>>

  <?php
}

// Fonction de callback pour l'affichage du champ Proxy Block
function slc_proxy_block_callback($args) {
  $option_name = $args[0];
  $options = get_option($option_name);
  ?>
<input type="checkbox" name="<?php echo $option_name.'[proxy-block]'; ?>" value="1" <?php checked($options['proxy-block'], 1, true); ?>>

  <?php
}

// Fonction de callback pour l'affichage du champ Weak Passwords
function slc_weak_passwords_callback($args) {
  $option_name = $args[0];
  $options = get_option($option_name);
  ?>
<input type="checkbox" name="<?php echo $option_name.'[weak-passwords]'; ?>" value="1" <?php checked($options['weak-passwords'], 1, true); ?>>

  <?php
}

// Fonction de callback pour l'affichage du champ Blacklist
function slc_blacklist_callback($args) {
  $option_name = $args[0];
  $options = get_option($option_name);
  ?>
  <input type="text" name="<?php echo $option_name.'[blacklist]'; ?>" value="<?php echo $options['blacklist']; ?>" size="75">
  <?php
}
// Fonction de callback pour l'affichage du champ Whitelist
function slc_whitelist_callback($args) {
$option_name = $args[0];
$options = get_option($option_name);
?>
<input type="text" name="<?php echo $option_name.'[whitelist]'; ?>" value="<?php echo $options['whitelist']; ?>" size="75">

  <?php
}

 

// Fonction de callback pour l'affichage du champ Login Attempts
function slc_login_attempts_callback($args) {
  $option_name = $args[0];
  $options = get_option($option_name);
  ?>
  <input type="number" name="<?php echo $option_name.'[login-attempts]'; ?>" value="<?php echo $options['login-attempts']; ?>" min="1" max="10">
  <?php
}

// Fonction de callback pour l'affichage du champ Account Lock Time
function slc_account_lock_time_callback($args) {
  $option_name = $args[0];
  $options = get_option($option_name);
  ?>
  <input type="number" name="<?php echo $option_name.'[account-lock-time]'; ?>" value="<?php echo $options['account-lock-time']; ?>" min="1" max="60">
  <?php
}

/***   Fonctions pour afficher les onglets     ***/

// Fonction de callback pour l'affichage du champ Activer 2FA Authentification
function slc_enable_2fa_callback() {
  $options = get_option('slc_2fa_settings');
  ?>
  <input type="checkbox" name="slc_2fa_settings[enable_2fa]" value="1" <?php checked($options['enable_2fa'], 1, true); ?>>

  <?php
}

// Fonction de callback pour l'affichage du champ Activer Code de Secours
function slc_enable_backup_codes_callback() {
  $options = get_option('slc_2fa_settings');
  ?>
  <input type="checkbox" name="slc_2fa_settings[enable_backup_codes]" value="1" <?php checked($options['enable_backup_codes'], 1, true); ?>>

  <?php
}

// Fonction de callback pour l'affichage du champ Interdire la Désactivation de 2FA Authentification
function slc_disable_2fa_disabling_callback() {
  $options = get_option('slc_2fa_settings');
  ?>
  <input type="checkbox" name="slc_2fa_settings[disable_2fa_disabling]" value="1" <?php checked($options['disable_2fa_disabling'], 1, true); ?>>

  <?php
}

// Fonction de callback pour l'affichage du champ Groupes de Sécurité où 2FA sera Activé
function slc_security_groups_callback() {
  $options = get_option('slc_2fa_settings');
  ?>
  <input type="text" name="slc_2fa_settings[security_groups]" value="<?php echo $options['security_groups']; ?>" size="75">
  <p class="description">Entrez les noms des groupes de sécurité séparés par des virgules où vous souhaitez activer l'authentification à deux facteurs. Exemple: Administrateurs, Éditeurs</p>

  <?php
}

// Fonction de callback pour l'affichage de la section 2FA Authentification
function slc_2fa_section_callback() {
  echo 'Personnalisez les options d\'authentification à deux facteurs pour votre site web.';
}

 
 
/*** Fin des fonctions d'affichage des onglets ***/
