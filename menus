<?php
/*
Plugin Name: SecureLoginCustomizer
Plugin URI: https://example.com
Description: Customize the WordPress login screen and add security options.
Version: 1.0
Author: Your Name
Author URI: https://example.com
License: GPL2
*/

// Add the Settings link on the plugin page
add_filter('plugin_action_links', 'secure_login_customizer_settings_link', 10, 2);
function secure_login_customizer_settings_link($links, $file) {
    static $this_plugin;
    if (!$this_plugin) {
        $this_plugin = plugin_basename(__FILE__);
    }
    if ($file == $this_plugin) {
        $settings_link = '<a href="' . admin_url('options-general.php?page=secure_login_customizer') . '">' . __('Settings', 'secure_login_customizer') . '</a>';
        array_unshift($links, $settings_link);
    }
    return $links;
}

// Add the admin menu and submenus
 add_action('admin_menu', 'secure_login_customizer_admin_menu');
function secure_login_customizer_admin_menu() {
    add_options_page(
        __('Secure Login Customizer', 'secure_login_customizer'),
        __('Secure Login Customizer', 'secure_login_customizer'),
        'manage_options',
        'secure_login_customizer',
        'secure_login_customizer_options_page'
    );
}

function secure_login_customizer() {
	// Create the admin page
	add_menu_page(
		__('Secure Login Customizer', 'secure_login_customizer'),
		__('Secure Login', 'secure_login_customizer'),
		'manage_options',
		'secure_login_customizer',
		'secure_login_customizer_page_content',
		'dashicons-lock',
		99
	);

	// Add settings sections and fields
	add_settings_section(
		'secure_login_customizer_section_1',
		__('Security Settings', 'secure_login_customizer'),
		'secure_login_customizer_section_1_content',
		'secure_login_customizer'
	);
	add_settings_field(
		'secure_login_customizer_field_1',
		__('2FA Login', 'secure_login_customizer'),
		'secure_login_customizer_field_1_content',
		'secure_login_customizer',
		'secure_login_customizer_section_1'
	);
	add_settings_field(
		'secure_login_customizer_field_2',
		__('Disable Proxy', 'secure_login_customizer'),
		'secure_login_customizer_field_2_content',
		'secure_login_customizer',
		'secure_login_customizer_section_1'
	);
	add_settings_field(
		'secure_login_customizer_field_3',
		__('Disable Weak Passwords', 'secure_login_customizer'),
		'secure_login_customizer_field_3_content',
		'secure_login_customizer',
		'secure_login_customizer_section_1'
	);

	add_settings_section(
		'secure_login_customizer_section_2',
		__('IP Address Whitelist/Blacklist', 'secure_login_customizer'),
		'secure_login_customizer_section_2_content',
		'secure_login_customizer'
	);
	add_settings_field(
		'secure_login_customizer_field_4',
		__('Whitelist/Blacklist', 'secure_login_customizer'),
		'secure_login_customizer_field_4_content',
		'secure_login_customizer',
		'secure_login_customizer_section_2'
	);
	add_settings_field(
		'secure_login_customizer_field_5',
		__('Login Attempts', 'secure_login_customizer'),
		'secure_login_customizer_field_5_content',
		'secure_login_customizer',
		'secure_login_customizer_section_2'
	);
	add_settings_field(
		'secure_login_customizer_field_6',
		__('Account Lockout', 'secure_login_customizer'),
		'secure_login_customizer_field_6_content',
		'secure_login_customizer',
		'secure_login_customizer_section_2'
	);

	add_settings_section(
		'secure_login_customizer_section_3',
		__('Login Page Customization', 'secure_login_customizer'),
		'secure_login_customizer_section_3_content',
		'secure_login_customizer'
	);
	add_settings_field(
		'secure_login_customizer_field_7',
		__('Logo URL', 'secure_login_customizer'),
		'secure_login_customizer_field_7_content',
		'secure_login_customizer',
		'secure_login_customizer_section_3'
	);
	add_settings_field(
		'secure_login_customizer_field_8',
		__('Desktop Background URL', 'secure_login_customizer'),
		'secure_login_customizer_field_8_content',
		'secure_login_customizer',
		'secure_login_customizer_section_3'
	);
	
// Mobile URL
add_settings_field(
	'secure_login_customizer_field_9',
	__('Mobile URL', 'secure_login_customizer'),
	'secure_login_customizer_field_9_content',
	'secure_login_customizer',
	'secure_login_customizer_section_3'
);

// Button Color
add_settings_field(
	'secure_login_customizer_field_10',
	__('Button Color', 'secure_login_customizer'),
	'secure_login_customizer_field_10_content',
	'secure_login_customizer',
	'secure_login_customizer_section_3'
);

// Background Color
add_settings_field(
	'secure_login_customizer_field_11',
	__('Background Color', 'secure_login_customizer'),
	'secure_login_customizer_field_11_content',
	'secure_login_customizer',
	'secure_login_customizer_section_3'
);

// Text Color
add_settings_field(
	'secure_login_customizer_field_12',
	__('Text Color', 'secure_login_customizer'),
	'secure_login_customizer_field_12_content',
	'secure_login_customizer',
	'secure_login_customizer_section_3'
);

// Border Color
add_settings_field(
	'secure_login_customizer_field_13',
	__('Border Color', 'secure_login_customizer'),
	'secure_login_customizer_field_13_content',
	'secure_login_customizer',
	'secure_login_customizer_section_3'
);

// Transparency
add_settings_field(
	'secure_login_customizer_field_14',
	__('Transparency', 'secure_login_customizer'),
	'secure_login_customizer_field_14_content',
	'secure_login_customizer',
	'secure_login_customizer_section_3'
);

// Register settings
register_setting(
	'secure_login_customizer_options',
	'secure_login_customizer_options',
	'secure_login_customizer_sanitize_options'
);
}

// Display the options page
function secure_login_customizer_options_page() {
    ?>
    <div class="wrap">
        <h1><?php echo __('Secure Login Customizer', 'secure_login_customizer'); ?></h1>
        <h2 class="nav-tab-wrapper">
            <a href="#tab1" class="nav-tab nav-tab-active"><?php echo __('Général', 'secure_login_customizer'); ?></a>
            <a href="#tab2" class="nav-tab"><?php echo __('Sécurité', 'secure_login_customizer'); ?></a>
            <a href="#tab3" class="nav-tab"><?php echo __('Customization login', 'secure_login_customizer'); ?></a>
            <a href="#tab4" class="nav-tab"><?php echo __('Customisation Messages', 'secure_login_customizer'); ?></a>
            <a href="#tab5" class="nav-tab"><?php echo __('Shortcodes & documentation', 'secure_login_customizer'); ?></a>
        </h2>
        <div id="tab1" class="tab-content">
            <?php secure_login_customizer_tab1_content(); ?>
        </div>
        <div id="tab2" class="tab-content">
            <?php secure_login_customizer_tab2_content(); ?>
        </div>
        <div id="tab3" class="tab-content">
            <?php secure_login_customizer_tab3_content(); ?>
        </div>
        <div id="tab4" class="tab-content">
            <?php secure_login_customizer_tab4_content(); ?>
        </div>
        <div id="tab5" class="tab-content">
            <?php secure_login_customizer_tab5_content(); ?>
        </div>
    </div>
    <?php
}

function secure_login_customizer_check_security($user, $username, $password) {
    // Get user ID
    $user_id = isset($user->ID) ? $user->ID : 0;

    // Get user meta
    $check_login_2fa = get_user_meta($user_id, 'secure_login_customizer_login_2fa', true);
    $check_disable_proxy = get_user_meta($user_id, 'secure_login_customizer_disable_proxy', true);
    $check_disable_weak_passwords = get_user_meta($user_id, 'secure_login_customizer_disable_weak_passwords', true);

    // Check 2FA
    if (!$check_login_2fa) {
        wp_logout();
        wp_safe_redirect(wp_login_url());
        exit;
    }

    // Check proxy
    if ($check_disable_proxy) {
        $ip_address = secure_login_customizer_get_ip_address();
        $whitelist = get_option('secure_login_customizer_options')['whitelist'];
        $blacklist = get_option('secure_login_customizer_options')['blacklist'];

        if (!empty($blacklist) && in_array($ip_address, explode(',', $blacklist))) {
            wp_logout();
            wp_safe_redirect(wp_login_url());
            exit;
        }
        if (!empty($whitelist) && !in_array($ip_address, explode(',', $whitelist))) {
            wp_logout();
            wp_safe_redirect(wp_login_url());
            exit;
        }
    }

    // Check weak passwords
    if ($check_disable_weak_passwords) {
        $password_blacklist = secure_login_customizer_get_password_blacklist();
        if (in_array($password, $password_blacklist)) {
            wp_logout();
            wp_safe_redirect(wp_login_url());
            exit;
        }
    }
}


 /*//   Display the form fields TAB1
echo '<form method="post" action="">';
wp_nonce_field('secure_login_customizer_options', 'secure_login_customizer_options_nonce');

echo '<table class="form-table">';
echo '<tbody>';
echo '<tr>';
echo '<th scope="row">';
echo '<label for="login_2fa">' . __('Activate 2FA authentication', 'secure_login_customizer') . '</label>';
echo '</th>';
echo '<td>';
echo '<input type="checkbox" name="secure_login_customizer_options[login_2fa]" id="login_2fa" value="1" ' . $check_login_2fa . '>';
echo '</td>';
echo '</tr>';

echo '<tr>';
echo '<th scope="row">';
echo '<label for="backup_codes">' . __('Activate backup codes', 'secure_login_customizer') . '</label>';
echo '</th>';
echo '<td>';
echo '<input type="checkbox" name="secure_login_customizer_options[backup_codes]" id="backup_codes" value="1" ' . $check_backup_codes . '>';
echo '</td>';
echo '</tr>';

echo '<tr>';
echo '<th scope="row">';
echo '<label for="disable_2fa">' . __('Disable 2FA authentication', 'secure_login_customizer') . '</label>';
echo '</th>';
echo '<td>';
echo '<input type="checkbox" name="secure_login_customizer_options[disable_2fa]" id="disable_2fa" value="1" ' . $check_disable_2fa . '>';
echo '</td>';
echo '</tr>';

echo '<tr>';
echo '<th scope="row">';
echo '<label for="groups_2fa">' . __('Select security groups where 2FA is enabled', 'secure_login_customizer') . '</label>';
echo '</th>';
echo '<td>';
echo '<input type="checkbox" name="secure_login_customizer_options[groups_2fa][]" value="administrator" ' . ($check_2fa_groups ? 'checked' : '') . '> Administrator<br />';
echo '<input type="checkbox" name="secure_login_customizer_options[groups_2fa][]" value="editor" ' . (in_array('editor', $options['groups_2fa']) ? 'checked' : '') . '> Editor<br />';
echo '<input type="checkbox" name="secure_login_customizer_options[groups_2fa][]" value="author" ' . (in_array('author', $options['groups_2fa']) ? 'checked' : '') . '> Author<br />';
echo '<input type="checkbox" name="secure_login_customizer_options[groups_2fa][]" value="contributor" ' . (in_array('contributor', $options['groups_2fa']) ? 'checked' : '') . '> Contributor<br />';
echo '</td>';
echo '</tr>';

echo '</tbody>';
echo '</table>';

echo '<p class="submit">';
echo '<input type="submit" name="submit" id="submit" class="button button-primary" value="' . __('Save Changes', 'secure_login_customizer') . '">';
echo '</p>';
echo '</form>';
}
 */
// Register settings
 add_action( 'admin_init', 'secure_login_customizer_register_settings' ); 

// verifie des cles dans la base
function secure_login_customizer_get_option($key, $default = '') {
    $options = get_option('secure_login_customizer_options', array());
    return isset($options[$key]) ? $options[$key] : $default;
}

// init variables
function secure_login_customizer_register_settings() {
	register_setting('secure_login_customizer_options', 'secure_login_customizer_options');
    $options = get_option('secure_login_customizer_options');

// Set default options
add_option('secure_login_customizer_options', array(
	'enable_2fa' => false,
	'hide_wp_version' => false,
	'hide_error_messages' => false,
	'anonymize_error_messages' => false,
	'disable_proxy' => false,
	'disable_weak_passwords' => false,
	'logo_url' => '',
	'button_color' => '#0073aa',
	'background_color' => '#f1f1f1',
	'text_color' => '#333333',
	'border_color' => '#dddddd',
	'transparency' => 50,
	'desktop_url' => '',
	'mobile_url' => '',
	'qr_code_url' => '',
	'code_secret_url' => '',
	'desactivation_compte_url' => '',
	'background_image_url' => ''
));


// Check if options are empty
if (empty($options)) {
	$options = array(
		'enable_2fa' => 0,
		'hide_wp_version' => 0,
		'hide_error_messages' => 0,
		'anonymize_error_messages' => 0,
		'qr_code_info_page_url' => '',
		'secret_codes_info_page_url' => '',
		'deactivate_account_info_page_url' => '',
		'logo_url' => '',
		'desktop_url' => '',
		'mobile_url' => '',
		'button_color' => '',
		'background_color' => '',
		'text_color' => '',
		'border_color' => '',
		'transparency' => ''
	);

	// Save options
	update_option('secure_login_customizer_options', $options);
}
}
add_action('admin_init', 'secure_login_customizer_register_settings');


// customiser settings

// BLOCK 4: Define settings sections and fields
function secure_login_customizer_settings() {
	// SECTION 1: 2FA settings
	add_settings_section(
		'secure_login_customizer_section_1',
		__('Two-Factor Authentication', 'secure_login_customizer'),
		'secure_login_customizer_section_1_content',
		'secure_login_customizer'
	);

	add_settings_field(
		'secure_login_customizer_field_1',
		__('Enable 2FA', 'secure_login_customizer'),
		'secure_login_customizer_field_1_content',
		'secure_login_customizer',
		'secure_login_customizer_section_1'
	);

	add_settings_field(
		'secure_login_customizer_field_2',
		__('Method', 'secure_login_customizer'),
		'secure_login_customizer_field_2_content',
		'secure_login_customizer',
		'secure_login_customizer_section_1'
	);

	add_settings_field(
		'secure_login_customizer_field_3',
		__('Backup Codes', 'secure_login_customizer'),
		'secure_login_customizer_field_3_content',
		'secure_login_customizer',
		'secure_login_customizer_section_1'
	);

	// SECTION 2: Security headers and settings
	add_settings_section(
		'secure_login_customizer_section_2',
		__('Security Headers and Settings', 'secure_login_customizer'),
		'secure_login_customizer_section_2_content',
		'secure_login_customizer'
	);

	add_settings_field(
		'secure_login_customizer_field_4',
		__('Enable Security Headers', 'secure_login_customizer'),
		'secure_login_customizer_field_4_content',
		'secure_login_customizer',
		'secure_login_customizer_section_2'
	);

	add_settings_field(
		'secure_login_customizer_field_5',
		__('Anonymize Login Error Messages', 'secure_login_customizer'),
		'secure_login_customizer_field_5_content',
		'secure_login_customizer',
		'secure_login_customizer_section_2'
	);

	add_settings_field(
		'secure_login_customizer_field_6',
		__('Proxy Server Detection', 'secure_login_customizer'),
		'secure_login_customizer_field_6_content',
		'secure_login_customizer',
		'secure_login_customizer_section_2'
	);


	add_settings_field(
		'secure_login_customizer_field_8',
		__('Disable Weak Passwords', 'secure_login_customizer'),
		'secure_login_customizer_field_8_content',
		'secure_login_customizer',
		'secure_login_customizer_section_2'
	);

	add_settings_section(
		'secure_login_customizer_section_3',
		__('Customize Login Form', 'secure_login_customizer'),
		'secure_login_customizer_section_3_content',
		'secure_login_customizer'
	);

	add_settings_field(
		'secure_login_customizer_field_7',
		__('Logo URL', 'secure_login_customizer'),
		'secure_login_customizer_field_7_content',
		'secure_login_customizer',
		'secure_login_customizer_section_3'
	);

	add_settings_field(
		'secure_login_customizer_field_9',
		__('Desktop Background Image URL', 'secure_login_customizer'),
		'secure_login_customizer_field_9_content',
		'secure_login_customizer',
		'secure_login_customizer_section_3'
	);

 
	// Mobile background image URL
	add_settings_field(
		'secure_login_customizer_field_10',
		__('Mobile Background Image URL', 'secure_login_customizer'),
		'secure_login_customizer_field_10_content',
		'secure_login_customizer',
		'secure_login_customizer_section_3'
	);

	// Button color
	add_settings_field(
		'secure_login_customizer_field_11',
		__('Button Color', 'secure_login_customizer'),
		'secure_login_customizer_field_11_content',
		'secure_login_customizer',
		'secure_login_customizer_section_3'
	);

	// Background color
	add_settings_field(
		'secure_login_customizer_field_12',
		__('Background Color', 'secure_login_customizer'),
		'secure_login_customizer_field_12_content',
		'secure_login_customizer',
		'secure_login_customizer_section_3'
	);

	// Text color
	add_settings_field(
		'secure_login_customizer_field_13',
		__('Text Color', 'secure_login_customizer'),
		'secure_login_customizer_field_13_content',
		'secure_login_customizer',
		'secure_login_customizer_section_3'
	);

	// Border color
	add_settings_field(
		'secure_login_customizer_field_14',
		__('Border Color', 'secure_login_customizer'),
		'secure_login_customizer_field_14_content',
		'secure_login_customizer',
		'secure_login_customizer_section_3'
	);

	// Transparency
	add_settings_field(
		'secure_login_customizer_field_15',
		__('Transparency', 'secure_login_customizer'),
		'secure_login_customizer_field_15_content',
		'secure_login_customizer',
		'secure_login_customizer_section_3'
	);

	// QR code info page URL
	add_settings_field(
		'secure_login_customizer_field_16',
		__('QR Code Info Page URL', 'secure_login_customizer'),
		'secure_login_customizer_field_16_content',
		'secure_login_customizer',
		'secure_login_customizer_section_4'
	);

	// Secret codes info page URL
	add_settings_field(
		'secure_login_customizer_field_17',
		__('Secret Codes Info Page URL', 'secure_login_customizer'),
		'secure_login_customizer_field_17_content',
		'secure_login_customizer',
		'secure_login_customizer_section_4'
	);

	// Account deactivation info page URL
	add_settings_field(
		'secure_login_customizer_field_18',
		__('Account Deactivation Info Page URL', 'secure_login_customizer'),
		'secure_login_customizer_field_18_content',
		'secure_login_customizer',
		'secure_login_customizer_section_4'
	);

	// BLOCK 5: Register the settings
	register_setting('secure_login_customizer_options', 'secure_login_customizer_options');
}
add_action('admin_menu', 'secure_login_customizer_admin_menu');


// BLOCK 1 GENERAL

function secure_login_customizer_tab1_content() {
	$options = get_option('secure_login_customizer_options');

	if (isset($options['enable_2fa'])) {
		$enable_2fa = $options['enable_2fa'];
	} else {
		$enable_2fa = false;
	}

	if (isset($options['hide_wp_version'])) {
		$hide_wp_version = $options['hide_wp_version'];
	} else {
		$hide_wp_version = false;
	}

	if (isset($options['hide_error_messages'])) {
		$hide_error_messages = $options['hide_error_messages'];
	} else {
		$hide_error_messages = false;
	}



	// Handle form submission
	if (isset($_POST['submit'])) {
		// Check nonce
		if (!isset($_POST['secure_login_customizer_options_nonce']) || !wp_verify_nonce($_POST['secure_login_customizer_options_nonce'], 'secure_login_customizer_options')) {
			die('Security check');
		}

		// Update options
		$options['enable_2fa'] = isset($_POST['secure_login_customizer_options']['enable_2fa']) ? absint($_POST['secure_login_customizer_options']['enable_2fa']) : 0;
		$options['hide_wp_version'] = isset($_POST['secure_login_customizer_options']['hide_wp_version']) ? absint($_POST['secure_login_customizer_options']['hide_wp_version']) : 0;
		$options['hide_error_messages'] = isset($_POST['secure_login_customizer_options']['hide_error_messages']) ? absint($_POST['secure_login_customizer_options']['hide_error_messages']) : 0;

		// Save options
		update_option('secure_login_customizer_options', $options);

		// Show message
		echo '<div class="notice notice-success is-dismissible"><p>' . __('Settings saved.', 'secure_login_customizer') . '</p></div>';
	}

	//  Get option values
	$enable_2fa = $options['enable_2fa'];
	$hide_wp_version = $options['hide_wp_version'];
	$hide_error_messages = $options['hide_error_messages'];

	//  Display the form fields
	echo '<form method="post" action="">';
	wp_nonce_field('secure_login_customizer_options', 'secure_login_customizer_options_nonce');

	echo '<table class="form-table">';
	echo '<tbody>';

	echo '<tr>';
	echo '<th scope="row">';
	echo '<label for="enable_2fa">' . __('Enable 2FA', 'secure_login_customizer') . '</label>';
	echo '</th>';
	echo '<td>';
	echo '<input type="checkbox" name="secure_login_customizer_options[enable_2fa]" id="enable_2fa" value="1" ' . checked(1, $enable_2fa, false) . '>';
	echo '</td>';
	echo '</tr>';

	echo '<tr>';
	echo '<th scope="row">';
	echo '<label for="hide_wp_version">' . __('Hide WordPress Version', 'secure_login_customizer') . '</label>';
	echo '</th>';
	echo '<td>';
	echo '<input type="checkbox" name="secure_login_customizer_options[hide_wp_version]" id="hide_wp_version" value="1" ' . checked(1, $hide_wp_version, false) . '>';
	echo '</td>';
	echo '</tr>';

	echo '<tr>';
	echo '<th scope="row">';
	echo '<label for="hide_error_messages">' . __('Anonymize Login Error Messages', 'secure_login_customizer') . '</label>';
	echo '</th>';
	echo '<td>';
	echo '<input type="checkbox" name="secure_login_customizer_options[hide_error_messages]" id="hide_error_messages" value="1" ' . checked(1, $hide_error_messages, false) . '>';
	echo '</td>';
	echo '</tr>';

	echo '</tbody>';
	echo '</table>';

	echo '<p><input type="submit" name="submit" id="submit" class="button button-primary" value="' . __('Save Changes', 'secure_login_customizer') . '"></p>';

	echo '</form>';
}


// BLOCK ONGLET 2
function secure_login_customizer_tab2_content() {
	$options = get_option('secure_login_customizer_options');
	$anonymize_error_messages = isset($options['anonymize_error_messages']) ? $options['anonymize_error_messages'] : 0;
	$block_proxy = isset($options['block_proxy']) ? $options['block_proxy'] : 0;
	$disable_weak_passwords = isset($options['disable_weak_passwords']) ? $options['disable_weak_passwords'] : 0;
	$blacklist = isset($options['blacklist']) ? $options['blacklist'] : '';
	$whitelist = isset($options['whitelist']) ? $options['whitelist'] : '';
	$attempts_before_lockout = isset($options['attempts_before_lockout']) ? absint($options['attempts_before_lockout']) : 0;
	$lockout_time = isset($options['lockout_time']) ? absint($options['lockout_time']) : 0;

		if (isset($options['anonymize_error_messages'])) {
			$anonymize_error_messages = $options['anonymize_error_messages'];
		} else {
			$anonymize_error_messages = false;
		}

		if (isset($options['disable_proxy'])) {
			$disable_proxy = $options['disable_proxy'];
		} else {
			$disable_proxy = false;
		}

		if (isset($options['disable_weak_passwords'])) {
			$disable_weak_passwords = $options['disable_weak_passwords'];
		} else {
			$disable_weak_passwords = false;
		}


	if (isset($_POST['submit'])) {
		if (!isset($_POST['secure_login_customizer_options_nonce']) || !wp_verify_nonce($_POST['secure_login_customizer_options_nonce'], 'secure_login_customizer_options')) {
			die('Security check');
		}
		$options['anonymize_error_messages'] = isset($_POST['secure_login_customizer_options']['anonymize_error_messages']) ? absint($_POST['secure_login_customizer_options']['anonymize_error_messages']) : 0;
		$options['block_proxy'] = isset($_POST['secure_login_customizer_options']['block_proxy']) ? absint($_POST['secure_login_customizer_options']['block_proxy']) : 0;
		$options['disable_weak_passwords'] = isset($_POST['secure_login_customizer_options']['disable_weak_passwords']) ? absint($_POST['secure_login_customizer_options']['disable_weak_passwords']) : 0;
		$options['blacklist'] = isset($_POST['secure_login_customizer_options']['blacklist']) ? sanitize_text_field($_POST['secure_login_customizer_options']['blacklist']) : '';
		$options['whitelist'] = isset($_POST['secure_login_customizer_options']['whitelist']) ? sanitize_text_field($_POST['secure_login_customizer_options']['whitelist']) : '';
		$options['attempts_before_lockout'] = isset($_POST['secure_login_customizer_options']['attempts_before_lockout']) ? absint($_POST['secure_login_customizer_options']['attempts_before_lockout']) : 0;
		$options['lockout_time'] = isset($_POST['secure_login_customizer_options']['lockout_time']) ? absint($_POST['secure_login_customizer_options']['lockout_time']) : 0;

		update_option('secure_login_customizer_options', $options);

		echo '<div class="notice notice-success is-dismissible"><p>' . __('Settings saved.', 'secure_login_customizer') . '</p></div>';
	}
	// BLOCK 3: Display the form fields
	echo '<form method="post" action="">';
	wp_nonce_field('secure_login_customizer_options', 'secure_login_customizer_options_nonce');

	echo '<table class="form-table">';
	echo '<tbody>';

	// Security Headers
	echo '<tr>';
	echo '<th scope="row">';
	echo '<label for="security_headers">' . __('Activate Security Headers', 'secure_login_customizer') . '</label>';
	echo '</th>';
	echo '<td>';
	echo '<input type="checkbox" name="secure_login_customizer_options[security_headers]" id="security_headers" value="1" ' . $check_security_headers . '>';
	echo '</td>';
	echo '</tr>';

	// Anonymize Messages
	
	
	$check_disable_proxy = isset($options['disable_proxy']) ? $options['disable_proxy'] : false;
	$check_disable_weak_passwords = isset($options['disable_weak_passwords']) ? $options['disable_weak_passwords'] : false;

	
	
	echo '<tr>';
	echo '<th scope="row">';
	echo '<label for="anonymize_messages">' . __('Activate Anonymize Messages', 'secure_login_customizer') . '</label>';
	echo '</th>';
	echo '<td>';
	echo '<input type="checkbox" name="secure_login_customizer_options[anonymize_messages]" id="anonymize_messages" value="1" ' . $check_anonymize_messages . '>';
	echo '</td>';
	echo '</tr>';

	// Disable Proxy
	echo '<tr>';
	echo '<th scope="row">';
	echo '<label for="disable_proxy">' . __('Disable Proxy Connections', 'secure_login_customizer') . '</label>';
	echo '</th>';
	echo '<td>';
	echo '<input type="checkbox" name="secure_login_customizer_options[disable_proxy]" id="disable_proxy" value="1" ' . $check_disable_proxy . '>';
	echo '</td>';
	echo '</tr>';

	// Disable Weak Passwords
	echo '<tr>';
	echo '<th scope="row">';
	echo '<label for="disable_weak_passwords">' . __('Disable Weak Passwords', 'secure_login_customizer') . '</label>';
	echo '</th>';
	echo '<td>';
	echo '<input type="checkbox" name="secure_login_customizer_options[disable_weak_passwords]" id="disable_weak_passwords" value="1" ' . $check_disable_weak_passwords . '>';
	echo '</td>';
	echo '</tr>';

	// Blacklist
	echo '<tr>';
	echo '<th scope="row">';
	echo '<label for="blacklist">' . __('Blacklist', 'secure_login_customizer') . '</label>';
	echo '</th>';
	echo '<td>';
	echo '<input type="text" name="secure_login_customizer_options[blacklist]" id="blacklist" value="' . $options['blacklist'] . '" class="regular-text">';
	echo '<p class="description">' . __('Enter comma-separated IP addresses or user agents to blacklist', 'secure_login_customizer') . '</p>';
	echo '</td>';
	echo '</tr>';

	// Whitelist
	echo '<tr>';
	echo '<th scope="row">';
	echo '<label for="whitelist">' . __('Whitelist', 'secure_login_customizer') . '</label>';
	echo '</th>';
	echo '<td>';
	echo '<input type="text" name="secure_login_customizer_options[whitelist]" id="whitelist" value="' . $options['whitelist'] . '" class="regular-text">';
	echo '<p class="description">' . __('Enter comma-separated IP addresses or user agents to whitelist', 'secure_login_customizer') . '</p>';
	echo '</td>';
	echo '</tr>';
	
		// Account lockout time
	echo '<tr>';
	echo '<th scope="row">';
	echo '<label for="account_lockout_time">' . __('Account lockout time', 'secure_login_customizer') . '</label>';
	echo '</th>';
	echo '<td>';
	echo '<input type="number" name="secure_login_customizer_options[account_lockout_time]" id="account_lockout_time" min="0" max="300" value="' . $options['account_lockout_time'] . '" class="small-text">';
	echo '<p class="description">' . __('Set the time in seconds to lock out the user after too many failed login attempts (0 for no lockout)', 'secure_login_customizer') . '</p>';
	echo '</td>';
	echo '</tr>';

	echo '</tbody>';
	echo '</table>';

	// Submit button
	echo '<p><input type="submit" name="submit" id="submit" class="button button-primary" value="' . __('Save Changes', 'secure_login_customizer') . '"></p>';

	// Close the form
	echo '</form>';
}


// Block  ONGLET 3  : Customization login

// BLOCK ONGLET 3
function secure_login_customizer_tab3_content() {

	$options = get_option('secure_login_customizer_options');

		if (isset($options['background_image_url'])) {
			$background_image_url = $options['background_image_url'];
		} else {
			$background_image_url = '';
		}


	// Handle form submission
	if (isset($_POST['submit'])) {
		// Check nonce
		if (!isset($_POST['secure_login_customizer_options_nonce']) || !wp_verify_nonce($_POST['secure_login_customizer_options_nonce'], 'secure_login_customizer_options')) {
			die('Security check');
		}

		// Update options
		$options['logo_url'] = isset($_POST['secure_login_customizer_options']['logo_url']) ? sanitize_text_field($_POST['secure_login_customizer_options']['logo_url']) : '';
		$options['desktop_url'] = isset($_POST['secure_login_customizer_options']['desktop_url']) ? sanitize_text_field($_POST['secure_login_customizer_options']['desktop_url']) : '';
		$options['mobile_url'] = isset($_POST['secure_login_customizer_options']['mobile_url']) ? sanitize_text_field($_POST['secure_login_customizer_options']['mobile_url']) : '';
		$options['button_color'] = isset($_POST['secure_login_customizer_options']['button_color']) ? sanitize_text_field($_POST['secure_login_customizer_options']['button_color']) : '';
		$options['background_color'] = isset($_POST['secure_login_customizer_options']['background_color']) ? sanitize_text_field($_POST['secure_login_customizer_options']['background_color']) : '';
		$options['text_color'] = isset($_POST['secure_login_customizer_options']['text_color']) ? sanitize_text_field($_POST['secure_login_customizer_options']['text_color']) : '';
		$options['border_color'] = isset($_POST['secure_login_customizer_options']['border_color']) ? sanitize_text_field($_POST['secure_login_customizer_options']['border_color']) : '';
		$options['transparency'] = isset($_POST['secure_login_customizer_options']['transparency']) ? absint($_POST['secure_login_customizer_options']['transparency']) : '';

		// Save options
		update_option('secure_login_customizer_options', $options);

		// Show message
		echo '<div class="notice notice-success is-dismissible"><p>' . __('Settings saved.', 'secure_login_customizer') . '</p></div>';
	}

	// BLOCK Get option values
	$logo_url = $options['logo_url'];
	$desktop_url = $options['desktop_url'];
	$mobile_url = $options['mobile_url'];
	$button_color = $options['button_color'];
	$background_color = $options['background_color'];
	$text_color = $options['text_color'];
	$border_color = $options['border_color'];
	$transparency = $options['transparency'];

	// BLOCK 3: Display the form fields
	echo '<form method="post" action="">';
	wp_nonce_field('secure_login_customizer_options', 'secure_login_customizer_options_nonce');

	echo '<table class="form-table">';
	echo '<tbody>';

	echo '<tr>';
	echo '<th scope="row">';
	echo '<label for="logo_url">' . __('Logo URL', 'secure_login_customizer') . '</label>';
	echo '</th>';
	echo '<td>';
	echo '<input type="text" name="secure_login_customizer_options[logo_url]" id="logo_url" value="' . $logo_url . '" class="regular-text" maxlength="75">';
	echo '</td>';
	echo '</tr>';

	echo '<tr>';
	echo '<th scope="row">';
	echo '<label for="desktop_url">' . __('Desktop URL', 'secure_login_customizer') . '</label>';
	echo '</th>';
	echo '<td>';
	echo '<input type="text" name="secure_login_customizer_options[desktop_url]" id="desktop_url" value="' . $desktop_url . '" class="regular-text" maxlength="75">';
	echo '</td>';
	echo '</tr>';

	echo '<tr>';
	echo '<th scope="row">';
	echo '<label for="mobile_url">' . __('Mobile URL', 'secure_login_customizer') . '</label>';
	echo '</th>';
	echo '<td>';
	echo '<input type="text" name="secure_login_customizer_options[mobile_url]" id="mobile_url" value="' . $mobile_url . '" class="regular-text" maxlength="75">';
	echo '</td>';
	echo '</tr>';

	echo '<tr>';
	echo '<th scope="row">';
	echo '<label for="button_color">' . __('Button Color', 'secure_login_customizer') . '</label>';
	echo '</th>';
	echo '<td>';
	echo '<input type="text" name="secure_login_customizer_options[button_color]" id="button_color" value="' . $button_color . '" class="regular-text">';
	echo '</td>';
	echo '</tr>';

	echo '<tr>';
	echo '<th scope="row">';
	echo '<label for="background_color">' . __('Background Color', 'secure_login_customizer') . '</label>';
	echo '</th>';
	echo '<td>';
	echo '<input type="text" name="secure_login_customizer_options[background_color]" id="background_color" value="' . $background_color . '" class="regular-text">';
	echo '</td>';
	echo '</tr>';

	echo '<tr>';
	echo '<th scope="row">';
	echo '<label for="text_color">' . __('Text Color', 'secure_login_customizer') . '</label>';
	echo '</th>';
	echo '<td>';
	echo '<input type="text" name="secure_login_customizer_options[text_color]" id="text_color" value="' . $text_color . '" class="regular-text">';
	echo '</td>';
	echo '</tr>';

	echo '<tr>';
	echo '<th scope="row">';
	echo '<label for="border_color">' . __('Border Color', 'secure_login_customizer') . '</label>';
	echo '</th>';
	echo '<td>';
	echo '<input type="text" name="secure_login_customizer_options[border_color]" id="border_color" value="' . $border_color . '" class="regular-text">';
	echo '</td>';
	echo '</tr>';

	echo '<tr>';
	echo '<th scope="row">';
	echo '<label for="transparency">' . __('Transparency Level', 'secure_login_customizer') . '</label>';
	echo '</th>';
	echo '<td>';
	echo '<input type="number" name="secure_login_customizer_options[transparency]" id="transparency" value="' . $transparency . '" min="0" max="100" class="small-text">';
	echo '<p class="description">' . __('Enter a value from 0 (completely opaque) to 100 (completely transparent)', 'secure_login_customizer') . '</p>';
	echo '</td>';
	echo '</tr>';

	echo '</tbody>';
	echo '</table>';

	// BLOCK  Submit button
	echo '<p><input type="submit" name="submit" id="submit" class="button button-primary" value="' . __('Save Changes', 'secure_login_customizer') . '"></p>';

	echo '</form>';
}



// Block  ONGLET 4  : Customization message settings

function secure_login_customizer_tab4_content() {

	$options = get_option('secure_login_customizer_options');

	// Handle form submission
	if (isset($_POST['submit'])) {
		// Check nonce
		if (!isset($_POST['secure_login_customizer_options_nonce']) || !wp_verify_nonce($_POST['secure_login_customizer_options_nonce'], 'secure_login_customizer_options')) {
			die('Security check');
		}

		// Update options
		$options['qrcode_url'] = isset($_POST['secure_login_customizer_options']['qrcode_url']) ? sanitize_text_field($_POST['secure_login_customizer_options']['qrcode_url']) : '';
		$options['secret_codes_url'] = isset($_POST['secure_login_customizer_options']['secret_codes_url']) ? sanitize_text_field($_POST['secure_login_customizer_options']['secret_codes_url']) : '';
		$options['deactivation_url'] = isset($_POST['secure_login_customizer_options']['deactivation_url']) ? sanitize_text_field($_POST['secure_login_customizer_options']['deactivation_url']) : '';

		// Save options
		update_option('secure_login_customizer_options', $options);

		// Show message
		echo '<div class="notice notice-success is-dismissible"><p>' . __('Settings saved.', 'secure_login_customizer') . '</p></div>';
	}

	// BLOCK 2: Get option values
	$qr_info_url = $options['qr_info_url'];
	$secret_info_url = $options['secret_info_url'];
	$deactivate_info_url = $options['deactivate_info_url'];

	// BLOCK 3: Display the form fields
	echo '<form method="post" action="">';
	wp_nonce_field('secure_login_customizer_options', 'secure_login_customizer_options_nonce');

	echo '<table class="form-table">';
	echo '<tbody>';

	echo '<tr>';
	echo '<th scope="row">';
	echo '<label for="qr_info_url">' . __('QR Code information URL', 'secure_login_customizer') . '</label>';
	echo '</th>';
	echo '<td>';
	echo '<input type="text" name="secure_login_customizer_options[qr_info_url]" id="qr_info_url" value="' . $qr_info_url . '" class="regular-text" maxlength="75">';
	echo '</td>';
	echo '</tr>';

	echo '<tr>';
	echo '<th scope="row">';
	echo '<label for="secret_info_url">' . __('Secret code information URL', 'secure_login_customizer') . '</label>';
	echo '</th>';
	echo '<td>';
	echo '<input type="text" name="secure_login_customizer_options[secret_info_url]" id="secret_info_url" value="' . $secret_info_url . '" class="regular-text" maxlength="75">';
	echo '</td>';
	echo '</tr>';

	echo '<tr>';
	echo '<th scope="row">';
	echo '<label for="deactivate_info_url">' . __('Deactivation information URL', 'secure_login_customizer') . '</label>';
	echo '</th>';
	echo '<td>';
	echo '<input type="text" name="secure_login_customizer_options[deactivate_info_url]" id="deactivate_info_url" value="' . $deactivate_info_url . '" class="regular-text" maxlength="75">';
	echo '</td>';
	echo '</tr>';

	echo '</tbody>';
	echo '</table>';

	echo '<p><input type="submit" name="submit" id="submit" class="button button-primary" value="' . __('Save Changes', 'secure_login_customizer') . '"></p>';
	echo '</form>';
}




// Block ONGLET 5 : Display content for Tab 5
function secure_login_customizer_tab5_content() {
    ?>
    <h3><?php echo __('ShortCodes et documentation', 'secure_login_customizer'); ?></h3>
    <p><?php echo __('Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus venenatis blandit neque in faucibus. Nullam consectetur, nulla id bibendum malesuada, nibh turpis suscipit justo, vel commodo ex lectus ut enim. Donec aliquam, est eget tincidunt lobortis, dui turpis venenatis nisi, quis scelerisque orci nulla in augue. Duis euismod sem metus, et lacinia odio volutpat a. Aliquam id suscipit risus, ut interdum risus. Ut ut elit lacinia, sagittis metus at, luctus enim. Vestibulum congue urna non justo blandit tincidunt. Donec faucibus tristique nulla, ac tincidunt lacus semper sit amet. Pellentesque bibendum metus quam, eu dignissim metus suscipit a. Duis vel velit at tellus laoreet pulvinar nec vel enim.', 'secure_login_customizer'); ?></p>
    <p><?php echo __('Phasellus ac elementum nibh. Curabitur nec tincidunt enim, vel dictum urna. Nam id vestibulum ipsum. Nam quis ex lobortis, convallis mauris eu, sollicitudin nisi. Sed blandit ante vel ante efficitur, nec lobortis justo fringilla. Sed quis elementum libero, a luctus mi. Proin interdum ipsum at tortor aliquet placerat. Suspendisse potenti. Sed et dolor vel purus tempor aliquet. Suspendisse tincidunt bibendum lorem ut feugiat. Aenean ut eros vel tellus posuere consequat sit amet in sapien. Ut bibendum, risus at blandit tincidunt, diam velit maximus ante, non porttitor metus dolor vel lectus. Sed tristique, urna sed molestie bibendum, lectus nunc vestibulum orci, vel dignissim tortor est in urna.', 'secure_login_customizer'); ?></p>
    <?php
}



